#include <iostream>
#include <fstream>
#include <string>

using namespace std;

// Funcion para verificar si el codigo ya existe en el archivo
bool codigoExiste(const string& codigo, const string& rutaArchivo) {
    ifstream archivo(rutaArchivo);
    string linea;

    while (getline(archivo, linea)) {
        // Busca la linea que contiene el codigo
        if (linea.find("--codigo:" + codigo) != string::npos) {
            archivo.close(); // Cierra el archivo despues de leer
            return true; // El codigo ya existe
        }
    }
    archivo.close(); // Cierra el archivo si no se encontro el codigo
    return false; // El codigo no existe
}

void agregarEstacion() {
    const string rutaArchivo = "C:\\Users\\LENOVO\\Documents\\termax_proyecto\\datos.txt";
    ofstream archivo(rutaArchivo, ios::app); // Abrir el archivo en modo de agregar (append)

    if (!archivo.is_open()) {
        cout << "Error al abrir el archivo." << endl;
        return;
    }

    string estacion, codigo, gerente, region, ubicacion;
    const string montDinero = "0"; // Monto inicial de dinero es 0

    // Solicitar los datos de la nueva estacion
    cout << "Ingrese el nombre de la estacion: ";
    getline(cin, estacion);

    // Solicitar el codigo y verificar que no este en uso
    do {
        cout << "Ingrese el codigo de la estacion: ";
        getline(cin, codigo);
        
        if (codigoExiste(codigo, rutaArchivo)) {
            cout << "El codigo ya existe. Por favor, ingrese uno diferente." << endl;
        }
    } while (codigoExiste(codigo, rutaArchivo)); // Repetir si el codigo ya existe

    cout << "Ingrese el nombre del gerente: ";
    getline(cin, gerente);
    cout << "Ingrese la region: ";
    getline(cin, region);
    cout << "Ingrese la ubicacion (coordenadas): ";
    getline(cin, ubicacion);

    // Escribir los datos en el archivo con el mismo formato
    archivo << "#" << endl;
    archivo << "-estacion:" << estacion << endl;
    archivo << "--codigo:" << codigo << endl; // Usar el codigo ingresado
    archivo << "---gerente:" << gerente << endl;
    archivo << "----region:" << region << endl;
    archivo << "-----mont_dinero:" << montDinero << endl;
    archivo << "------ubicacion:" << ubicacion << endl;
    archivo << "#" << endl;  // Fin del bloque de la nueva estacion

    archivo.close();
    cout << "Estacion agregada correctamente." << endl;
}

int main() {
    agregarEstacion();
    return 0;
}


